/*! For license information please see FrontendGoogleMap.min.js.LICENSE.txt */
(()=>{"use strict";var t=Object.prototype.toString,e=Array.isArray||function(e){return"[object Array]"===t.call(e)};function n(t){return"function"==typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}var a=RegExp.prototype.test,r=/\S/;var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},l=/\s*/,p=/\s+/,c=/\s*=/,h=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function u(t){this.string=t,this.tail=t,this.pos=0}function g(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function d(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},u.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},g.prototype.push=function(t){return new g(t,this)},g.prototype.lookup=function(t){var e,i,a,r=this.cache;if(r.hasOwnProperty(t))e=r[t];else{for(var s,l,p,c=this,h=!1;c;){if(t.indexOf(".")>0)for(s=c.view,l=t.split("."),p=0;null!=s&&p<l.length;)p===l.length-1&&(h=o(s,l[p])||(i=s,a=l[p],null!=i&&"object"!=typeof i&&i.hasOwnProperty&&i.hasOwnProperty(a))),s=s[l[p++]];else s=c.view[t],h=o(c.view,t);if(h){e=s;break}c=c.parent}r[t]=e}return n(e)&&(e=e.call(this.view)),e},d.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},d.prototype.parse=function(t,n){var o=this.templateCache,s=t+":"+(n||m.tags).join(":"),g=void 0!==o,d=g?o.get(s):void 0;return null==d&&(d=function(t,n){if(!t)return[];var o,s,g,d,w=!1,y=[],v=[],C=[],k=!1,b=!1,x="",I=0;function W(){if(k&&!b)for(;C.length;)delete v[C.pop()];else C=[];k=!1,b=!1}function L(t){if("string"==typeof t&&(t=t.split(p,2)),!e(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(i(t[0])+"\\s*"),s=new RegExp("\\s*"+i(t[1])),g=new RegExp("\\s*"+i("}"+t[1]))}L(n||m.tags);for(var T,S,z,U,j,E,O=new u(t);!O.eos();){if(T=O.pos,z=O.scanUntil(o))for(var V=0,M=z.length;V<M;++V)d=U=z.charAt(V),function(t,e){return a.call(t,e)}(r,d)?(b=!0,w=!0,x+=" "):(C.push(v.length),x+=U),v.push(["text",U,T,T+1]),T+=1,"\n"===U&&(W(),x="",I=0,w=!1);if(!O.scan(o))break;if(k=!0,S=O.scan(f)||"name",O.scan(l),"="===S?(z=O.scanUntil(c),O.scan(c),O.scanUntil(s)):"{"===S?(z=O.scanUntil(g),O.scan(h),O.scanUntil(s),S="&"):z=O.scanUntil(s),!O.scan(s))throw new Error("Unclosed tag at "+O.pos);if(j=">"==S?[S,z,T,O.pos,x,I,w]:[S,z,T,O.pos],I++,v.push(j),"#"===S||"^"===S)y.push(j);else if("/"===S){if(!(E=y.pop()))throw new Error('Unopened section "'+z+'" at '+T);if(E[1]!==z)throw new Error('Unclosed section "'+E[1]+'" at '+T)}else"name"===S||"{"===S||"&"===S?b=!0:"="===S&&L(z)}if(W(),E=y.pop())throw new Error('Unclosed section "'+E[1]+'" at '+O.pos);return function(t){for(var e,n=[],i=n,o=[],a=0,r=t.length;a<r;++a)switch((e=t[a])[0]){case"#":case"^":i.push(e),o.push(e),i=e[4]=[];break;case"/":o.pop()[5]=e[2],i=o.length>0?o[o.length-1][4]:n;break;default:i.push(e)}return n}(function(t){for(var e,n,i=[],o=0,a=t.length;o<a;++o)(e=t[o])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(i.push(e),n=e));return i}(v))}(t,n),g&&o.set(s,d)),d},d.prototype.render=function(t,e,n,i){var o=this.getConfigTags(i),a=this.parse(t,o),r=e instanceof g?e:new g(e,void 0);return this.renderTokens(a,r,n,t,i)},d.prototype.renderTokens=function(t,e,n,i,o){for(var a,r,s,l="",p=0,c=t.length;p<c;++p)s=void 0,"#"===(r=(a=t[p])[0])?s=this.renderSection(a,e,n,i,o):"^"===r?s=this.renderInverted(a,e,n,i,o):">"===r?s=this.renderPartial(a,e,n,o):"&"===r?s=this.unescapedValue(a,e):"name"===r?s=this.escapedValue(a,e,o):"text"===r&&(s=this.rawValue(a)),void 0!==s&&(l+=s);return l},d.prototype.renderSection=function(t,i,o,a,r){var s=this,l="",p=i.lookup(t[1]);if(p){if(e(p))for(var c=0,h=p.length;c<h;++c)l+=this.renderTokens(t[4],i.push(p[c]),o,a,r);else if("object"==typeof p||"string"==typeof p||"number"==typeof p)l+=this.renderTokens(t[4],i.push(p),o,a,r);else if(n(p)){if("string"!=typeof a)throw new Error("Cannot use higher-order sections without the original template");null!=(p=p.call(i.view,a.slice(t[3],t[5]),(function(t){return s.render(t,i,o,r)})))&&(l+=p)}else l+=this.renderTokens(t[4],i,o,a,r);return l}},d.prototype.renderInverted=function(t,n,i,o,a){var r=n.lookup(t[1]);if(!r||e(r)&&0===r.length)return this.renderTokens(t[4],n,i,o,a)},d.prototype.indentPartial=function(t,e,n){for(var i=e.replace(/[^ \t]/g,""),o=t.split("\n"),a=0;a<o.length;a++)o[a].length&&(a>0||!n)&&(o[a]=i+o[a]);return o.join("\n")},d.prototype.renderPartial=function(t,e,i,o){if(i){var a=this.getConfigTags(o),r=n(i)?i(t[1]):i[t[1]];if(null!=r){var s=t[6],l=t[5],p=t[4],c=r;0==l&&p&&(c=this.indentPartial(r,p,s));var h=this.parse(c,a);return this.renderTokens(h,e,i,c,o)}}},d.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},d.prototype.escapedValue=function(t,e,n){var i=this.getConfigEscape(n)||m.escape,o=e.lookup(t[1]);if(null!=o)return"number"==typeof o&&i===m.escape?String(o):i(o)},d.prototype.rawValue=function(t){return t[1]},d.prototype.getConfigTags=function(t){return e(t)?t:t&&"object"==typeof t?t.tags:void 0},d.prototype.getConfigEscape=function(t){return t&&"object"==typeof t&&!e(t)?t.escape:void 0};var m={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){w.templateCache=t},get templateCache(){return w.templateCache}},w=new d;m.clearCache=function(){return w.clearCache()},m.parse=function(t,e){return w.parse(t,e)},m.render=function(t,n,i,o){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(e(a=t)?"array":typeof a)+'" was given as the first argument for mustache#render(template, view, partials)');var a;return w.render(t,n,i,o)},m.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,(function(t){return s[t]}))},m.Scanner=u,m.Context=g,m.Writer=d;const y=m;class v{constructor(){this.mapConfiguration={active:!1,afterSearch:0,center:{lat:0,lng:0},zoom:18,apiConsoleKey:"",apiUrl:"",language:"",markerIcon:"",apiV3Layers:"",kmlUrl:"",renderSingleViewCallback:null,handleCloseButtonCallback:null},this.locations=[],this.locationIndex=0,this.infoWindowTemplate="","object"==typeof window.mapConfiguration&&window.mapConfiguration.active&&(this.mapConfiguration=window.mapConfiguration),this.mapConfiguration.active&&("object"==typeof window.locations&&(this.locations=window.locations),this.loadScript())}initializeMap(){}initializeLayer(){}renderInfoWindowContent(t){return y.render(this.infoWindowTemplate,t.information)}createMarker(t,e){}processLocation(t){let e="";t.information.icon?e=t.information.icon:Object.prototype.hasOwnProperty.call(this.mapConfiguration,"markerIcon")&&(e=this.mapConfiguration.markerIcon),this.locationIndex++,t.information.index=this.locationIndex,t.marker=this.createMarker(t,e)}initializeLocations(){this.locations.map(this.processLocation.bind(this))}initializeInfoWindow(){}closeInfoWindow(){}openInfoWindow(t){}initializeListEvents(){$(document).on("click",(t=>{$(t.target).is(".tx-storefinder .resultList > li")&&this.openInfoWindow($(t.target).data("index"))}))}initializeTemplates(){this.infoWindowTemplate=$("#templateInfoWindow").html(),y.parse(this.infoWindowTemplate),$(document).on("click",(t=>{$(t.target).is(".tx-storefinder .infoWindow .close")&&("function"==typeof this.mapConfiguration.renderSingleViewCallback?this.mapConfiguration.handleCloseButtonCallback($(t.target)):this.closeInfoWindow())}))}postLoadScript(){this.initializeMap(),this.initializeLayer(),this.initializeLocations(),this.initializeInfoWindow(),this.initializeTemplates(),this.initializeListEvents()}loadScript(){}}new class extends v{initializeMap(){let t;t=void 0!==this.mapConfiguration.center?new google.maps.LatLng(this.mapConfiguration.center.lat,this.mapConfiguration.center.lng):new google.maps.LatLng(0,0);const e={zoom:this.mapConfiguration.zoom,center:t,disableDefaultUI:!0,zoomControl:!0,styles:[],zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM}};self.mapConfiguration.mapStyles&&(e.styles=self.mapConfiguration.mapStyles),this.map=new google.maps.Map($("#tx_storefinder_map")[0],e),0===this.mapConfiguration.afterSearch&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const e={lat:t.coords.latitude,lng:t.coords.longitude};this.map.setCenter(e)}))}initializeLayer(){this.mapConfiguration.apiV3Layers.indexOf("traffic")>-1&&(new google.maps.TrafficLayer).setMap(this.map),this.mapConfiguration.apiV3Layers.indexOf("bicycling")>-1&&(new google.maps.BicyclingLayer).setMap(this.map),this.mapConfiguration.apiV3Layers.indexOf("kml")>-1&&new google.maps.KmlLayer({url:this.mapConfiguration.kmlUrl}).setMap(this.map)}showInformation(t,e){"function"==typeof this.mapConfiguration.renderSingleViewCallback?this.mapConfiguration.renderSingleViewCallback(t,this.infoWindowTemplate):(this.infoWindow.close(),this.infoWindow.setContent(this.renderInfoWindowContent(t)),this.infoWindow.setPosition(e.getPosition()),this.infoWindow.open(this.map,e))}createMarker(t,e){const n={title:t.name,position:new google.maps.LatLng(t.lat,t.lng),icon:e},i=new google.maps.Marker(n);return i.setMap(this.map),i.addListener("click",(()=>{this.showInformation(t,i)})),i}initializeInfoWindow(){this.infoWindow=new google.maps.InfoWindow}closeInfoWindow(){this.infoWindow.close()}openInfoWindow(t){google.maps.event.trigger(this.locations[t].marker,"click")}loadScript(){let t="https://maps.googleapis.com/maps/api/js?v=3.exp",e="&key="+this.mapConfiguration.apiConsoleKey;""!==this.mapConfiguration.language&&(e+="&language="+this.mapConfiguration.language),Object.prototype.hasOwnProperty.call(this.mapConfiguration,"apiUrl")&&(t=this.mapConfiguration.apiUrl);const n=$.Deferred(),i=$("<script/>",{src:t+e,crossorigin:""}).appendTo("head");n.resolve(i),$.when(n.promise()).done((()=>{window.requestAnimationFrame(function t(){"undefined"!=typeof google?this.postLoadScript():window.requestAnimationFrame(t.bind(this))}.bind(this))})).fail((()=>{console.log("Failed loading resources.")}))}}})();
//# sourceMappingURL=FrontendGoogleMap.min.js.map